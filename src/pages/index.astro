---
const colors = [
  '#e31b52','#c62828','#d32f2f','#e53935','#ef5350',
  '#f44336','#ff1744','#ff4081','#c0354a','#b71c1c',
  '#ad1457','#d81b60','#e91e63','#ff5252','#cc2244','#a8203a'
];

const canopyHearts: {x:number,y:number,size:number,color:string,delay:number}[] = [];
const cx = 220;
const cy = 185;

for (let layer = 0; layer < 4; layer++) {
  const count = 80;
  const scaleBase = 6 + layer * 3.5;
  for (let i = 0; i < count; i++) {
    const t = (i / count) * Math.PI * 2;
    const hxRaw = 16 * Math.pow(Math.sin(t), 3);
    const hyRaw = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
    const scale = scaleBase + Math.random() * 2.5;
    const x = cx + hxRaw * scale + (Math.random() - 0.5) * 22;
    const y = cy + hyRaw * scale + (Math.random() - 0.5) * 18;
    const size = 13 + Math.random() * 24;
    canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.0 + Math.random()*1.8 });
  }
}
for (let i = 0; i < 100; i++) {
  const angle = Math.random() * Math.PI * 2;
  const r = Math.random() * 120;
  const x = cx + Math.cos(angle) * r + (Math.random()-0.5)*15;
  const y = cy + Math.sin(angle) * r * 0.85 + 10;
  const size = 10 + Math.random() * 26;
  canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.2 + Math.random()*2.2 });
}
for (let i = 0; i < 30; i++) {
  const x = cx + (Math.random()-0.5) * 60;
  const y = cy + 100 + Math.random() * 80;
  const size = 12 + Math.random() * 20;
  canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.3 + Math.random()*1.5 });
}
---

<html lang="es">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>San Valentín</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet" />
</head>
<body>

  <!-- STATE 1: shared -->
  <div class="state-initial" id="stateInitial">
    <div class="heart-wrapper" id="heartClick">
      <div class="main-heart">❤</div>
      <div class="heart-label">San Valentín</div>
      <div class="click-hint">☝ Toca aquí</div>
    </div>
  </div>

  <!-- STATE 2 DESKTOP: tree -->
  <div class="state-tree hidden" id="stateTree">
    <div class="falling-heart" id="fallingHeart">❤</div>
    <div class="tree-wrap" id="treeWrap">
      <div class="trunk"></div>
      <div class="tbranch tb1"></div>
      <div class="tbranch tb2"></div>
      <div class="tbranch tb3"></div>
      <div class="tbranch tb4"></div>
      <div class="canopy">
        {canopyHearts.map((h) => (
          <span class="ch" style={`left:${h.x}px;top:${h.y}px;font-size:${h.size}px;color:${h.color};animation-delay:${h.delay}s`}>❤</span>
        ))}
      </div>
    </div>
    <div class="love-text" id="loveText">
      <p class="tl tl1">Para el amor de mi vida:</p>
      <p class="tl tl2">Si pudiera elegir un lugar<br/>seguro, sería a tu lado.</p>
      <p class="tl tl3">Cuanto más tiempo estoy<br/>contigo más te amo.</p>
      <p class="tl tl4">— I Love You!</p>
    </div>
    <div class="counter" id="counter">
      <p class="cl">Mi amor por ti comenzó hace...</p>
      <p class="ct" id="ct"></p>
    </div>
  </div>

  <!-- STATE 2 MOBILE: canvas hearts + confetti + text -->
  <div class="mob-state hidden" id="mobState">
    <canvas id="mobCanvas"></canvas>

    <div class="mob-content">
      <div class="mob-heart-wrap" id="mobHeartWrap">
        <div class="mob-glow"></div>
        <div class="mob-heart" id="mobHeart">❤</div>
      </div>

      <div class="mob-text" id="mobText">
        <p class="mt mt1">Para el amor de mi vida:</p>
        <p class="mt mt2">Si pudiera elegir un lugar<br/>seguro, sería a tu lado.</p>
        <p class="mt mt3">Cuanto más tiempo estoy<br/>contigo más te amo.</p>
        <p class="mt mt4">— I Love You!</p>
      </div>

      <!-- SVG heart draw animation -->
      <div class="mob-svg-wrap" id="mobSvg">
        <svg viewBox="0 0 200 180" class="mob-svg-heart">
          <!-- Heart outline that draws itself -->
          <path class="svg-heart-path" d="M100,170 C40,120 0,80 0,50 C0,20 20,0 50,0 C70,0 90,15 100,35 C110,15 130,0 150,0 C180,0 200,20 200,50 C200,80 160,120 100,170Z"
            fill="none" stroke="#e31b52" stroke-width="2.5" stroke-linecap="round"/>
          <!-- Fill heart (appears after stroke) -->
          <path class="svg-heart-fill" d="M100,170 C40,120 0,80 0,50 C0,20 20,0 50,0 C70,0 90,15 100,35 C110,15 130,0 150,0 C180,0 200,20 200,50 C200,80 160,120 100,170Z"
            fill="#e31b52" stroke="none" opacity="0"/>
        </svg>
        <p class="svg-label svg-link" id="svgLink">y nuestro amor creció<br/>tanto que ahora...<br/><span class="svg-hint">tócame ☝</span></p>
      </div>

      <div class="mob-counter" id="mobCounter">
        <p class="mob-cl">Mi amor por ti comenzó hace...</p>
        <p class="mob-ct" id="mobCt"></p>
      </div>
    </div>
  </div>

  <!-- STATE 3: Baby Reveal (mobile) -->
  <div class="baby-state hidden" id="babyState">

    <!-- Concept 1: El Latido -->
    <div class="baby-scene" id="baby1">
      <div class="b1-sparks" id="b1Sparks"></div>
      <div class="b1-wrap">
        <svg class="b1-ecg" viewBox="0 0 320 80">
          <path class="b1-line" d="M0,40 L75,40 L84,36 L92,40 L100,40 L107,20 L114,60 L118,6 L122,66 L129,28 L137,40 L178,40 L186,36 L194,40 L202,40 L209,20 L216,60 L220,6 L224,66 L231,28 L239,40 L320,40"
            fill="none" stroke="rgba(232,170,185,.65)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p class="b1-t1">En unas semanas nacerá</p>
        <p class="b1-t2">nuestro más grande amor</p>
        <p class="b1-name">Paulo Alberto</p>
        <div class="b1-heart">❤</div>
      </div>
    </div>

    <!-- Concept 2: Estrellas -->
    <div class="baby-scene" id="baby2">
      <canvas id="b2Canvas"></canvas>
      <div class="b2-wrap">
        <p class="b2-t1">En unas semanas nacerá</p>
        <p class="b2-t2">nuestro más grande amor</p>
        <div class="b2-glow"></div>
        <p class="b2-name">Paulo Alberto</p>
        <div class="b2-heart">❤</div>
        <p class="b2-sub">Te esperamos</p>
      </div>
    </div>

    <!-- Concept 3: Floreciendo -->
    <div class="baby-scene" id="baby3">
      <div class="b3-dust" id="b3Dust"></div>
      <div class="b3-wrap">
        <p class="b3-t1">En unas semanas nacerá</p>
        <p class="b3-t2">nuestro más grande amor</p>
        <div class="b3-flower-area">
          <svg class="b3-flower" viewBox="0 0 200 200">
            <g transform="translate(100,100)">
              <g transform="rotate(0)"><ellipse class="b3-p" style="--pd:0s" cx="0" cy="-40" rx="20" ry="40" fill="#b4d4f0"/></g>
              <g transform="rotate(60)"><ellipse class="b3-p" style="--pd:.18s" cx="0" cy="-40" rx="20" ry="40" fill="#a0c8ec"/></g>
              <g transform="rotate(120)"><ellipse class="b3-p" style="--pd:.36s" cx="0" cy="-40" rx="20" ry="40" fill="#8ebce4"/></g>
              <g transform="rotate(180)"><ellipse class="b3-p" style="--pd:.54s" cx="0" cy="-40" rx="20" ry="40" fill="#a0c8ec"/></g>
              <g transform="rotate(240)"><ellipse class="b3-p" style="--pd:.72s" cx="0" cy="-40" rx="20" ry="40" fill="#b4d4f0"/></g>
              <g transform="rotate(300)"><ellipse class="b3-p" style="--pd:.9s" cx="0" cy="-40" rx="20" ry="40" fill="#8ebce4"/></g>
              <circle class="b3-ctr" cx="0" cy="0" r="14" fill="#d4a574" opacity="0"/>
            </g>
          </svg>
        </div>
        <p class="b3-name">Paulo Alberto</p>
        <p class="b3-sub">Muy pronto...</p>
      </div>
    </div>

    <!-- Option buttons -->
    <div class="baby-opts">
      <button class="bopt active" data-v="1">El Latido</button>
      <button class="bopt" data-v="2">Estrellas</button>
      <button class="bopt" data-v="3">Floreciendo</button>
    </div>
  </div>

  <!-- canvas-confetti CDN -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      width:100vw;height:100vh;overflow:hidden;
      font-family:'Playfair Display',Georgia,serif;
      background:linear-gradient(160deg,#fdf2f0,#f8e1dc 30%,#f2d0ca 60%,#ecc4bd);
      color:#4a2028;
    }

    /* ============ STATE 1 (shared) ============ */
    .state-initial{
      position:fixed;inset:0;z-index:10;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(160deg,#fdf2f0,#f8e1dc 30%,#f2d0ca 60%,#ecc4bd);
      transition:opacity .8s ease;
    }
    .state-initial.fade-out{opacity:0;pointer-events:none}
    .state-initial.gone{display:none}
    .heart-wrapper{
      display:flex;flex-direction:column;align-items:center;
      cursor:pointer;user-select:none;z-index:2;
      animation:pulse 1.5s ease-in-out infinite;
    }
    .main-heart{font-size:7rem;color:#e31b52;line-height:1;filter:drop-shadow(0 4px 25px rgba(220,40,80,.5))}
    .heart-label{font-family:'Dancing Script',cursive;font-size:2.4rem;font-weight:700;margin-top:.5rem;color:#c0354a}
    .click-hint{margin-top:1.2rem;font-size:.9rem;color:#a05060;animation:blink 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
    @keyframes blink{0%,100%{opacity:.4}50%{opacity:1}}

    /* ============ STATE 2 DESKTOP ============ */
    .state-tree{position:fixed;inset:0;z-index:10}
    .state-tree.hidden{display:none}

    .falling-heart{
      position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);
      font-size:5rem;color:#e31b52;z-index:20;opacity:0;
      filter:drop-shadow(0 4px 15px rgba(220,40,80,.5));
    }
    .falling-heart.go{animation:hfall 1.5s cubic-bezier(.55,0,1,.45) forwards}
    @keyframes hfall{
      0%{top:45%;transform:translate(-50%,-50%) scale(1);opacity:1}
      65%{top:88%;transform:translate(-50%,-50%) scale(.7);opacity:1}
      75%{top:84%;transform:translate(-50%,-50%) scale(.8);opacity:1}
      85%{top:88%;transform:translate(-50%,-50%) scale(.5) rotate(10deg);opacity:1}
      95%{top:88%;transform:translate(-50%,-50%) scale(.2) rotate(15deg);opacity:.5}
      100%{top:88%;transform:translate(-50%,-50%) scale(0) rotate(20deg);opacity:0}
    }

    .tree-wrap{
      position:absolute;bottom:0;left:50%;transform:translateX(-25%);
      width:440px;height:580px;opacity:0;z-index:15;
    }
    .tree-wrap.grow{animation:tgrow 1.2s cubic-bezier(.2,.8,.3,1) forwards}
    @keyframes tgrow{
      0%{opacity:0;transform:translateX(-25%) scaleY(0);transform-origin:bottom center}
      40%{opacity:1}
      100%{opacity:1;transform:translateX(-25%) scaleY(1);transform-origin:bottom center}
    }
    .trunk{
      position:absolute;bottom:0;left:50%;transform:translateX(-50%);
      width:26px;height:280px;
      background:linear-gradient(to right,#5a3020,#8B5E3C,#6b3a2a);border-radius:6px;
    }
    .tbranch{position:absolute;background:linear-gradient(to top,#6b3a2a,#8B5E3C);border-radius:4px;transform-origin:bottom center}
    .tb1{bottom:175px;left:calc(50% - 9px);width:10px;height:85px;transform:rotate(30deg)}
    .tb2{bottom:195px;left:calc(50% + 1px);width:10px;height:90px;transform:rotate(-25deg)}
    .tb3{bottom:225px;left:calc(50% - 15px);width:8px;height:60px;transform:rotate(48deg)}
    .tb4{bottom:235px;left:calc(50% + 8px);width:8px;height:55px;transform:rotate(-42deg)}
    .canopy{position:absolute;top:0;left:0;width:440px;height:400px}
    .ch{position:absolute;line-height:1;opacity:0;filter:drop-shadow(0 1px 3px rgba(0,0,0,.12));margin-left:-.5em;margin-top:-.5em}
    .tree-wrap.grow .ch{animation:bloom .5s ease forwards}
    @keyframes bloom{
      0%{opacity:0;transform:scale(0) rotate(-20deg)}
      70%{transform:scale(1.2) rotate(5deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }
    .love-text{position:absolute;top:12%;left:5%;max-width:320px;z-index:16}
    .tl{font-size:1.15rem;font-weight:500;line-height:1.6;margin-bottom:1.1rem;color:#3a1520;opacity:0;transform:translateX(-15px)}
    .tl.show{animation:trev .9s ease forwards}
    .tl1{font-style:italic;color:#4a2030}
    .tl4{font-family:'Dancing Script',cursive;font-size:2rem;font-weight:700;color:#c0354a;margin-top:.5rem}
    @keyframes trev{0%{opacity:0;transform:translateX(-15px)}100%{opacity:1;transform:translateX(0)}}
    .counter{position:absolute;bottom:4%;left:5%;z-index:16;opacity:0}
    .counter.show{animation:fup 1s ease forwards}
    .cl{font-size:1rem;color:#5a2a35;margin-bottom:.3rem}
    .ct{font-family:'Dancing Script',cursive;font-size:1.4rem;font-weight:700;color:#c0354a}
    .ct b{font-size:1.7rem;color:#e31b52;margin:0 2px}
    @keyframes fup{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}

    /* Tablet */
    @media(max-width:768px) and (min-width:481px){
      .main-heart{font-size:5rem}
      .heart-label{font-size:1.8rem}
      .tree-wrap{width:350px;height:480px;left:50%;transform:translateX(-20%)}
      .canopy{width:350px;height:320px}
      .ch{font-size:.75em !important}
      .trunk{height:220px;width:22px}
      .love-text{top:5%;left:4%;max-width:42%}
      .tl{font-size:.92rem;margin-bottom:.8rem}
      .tl4{font-size:1.4rem}
      .ct{font-size:1.1rem}.ct b{font-size:1.3rem}
    }

    /* Hide desktop state2 on mobile, show mobile state2 */
    @media(max-width:480px){
      .state-tree{display:none !important}
      .main-heart{font-size:4.5rem}
      .heart-label{font-size:1.6rem}
      .click-hint{font-size:.8rem}
    }

    /* ============ STATE 2 MOBILE ============ */
    .mob-state{position:fixed;inset:0;z-index:10;overflow:hidden}
    .mob-state.hidden{display:none}

    #mobCanvas{position:absolute;inset:0;width:100%;height:100%;z-index:1}

    .mob-content{position:relative;z-index:2;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 8%}

    /* Hero heart */
    .mob-heart-wrap{position:relative;margin-bottom:1.5rem;opacity:0}
    .mob-heart-wrap.show{animation:mhIn 1.2s cubic-bezier(.2,.8,.3,1) forwards}
    .mob-heart{font-size:5.5rem;color:#e31b52;line-height:1;filter:drop-shadow(0 0 35px rgba(227,27,82,.6))}
    .mob-heart-wrap.show .mob-heart{animation:mhPulse 2s ease-in-out .8s infinite}
    .mob-glow{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      width:180px;height:180px;border-radius:50%;
      background:radial-gradient(circle,rgba(227,27,82,.2) 0%,transparent 70%);
    }
    .mob-heart-wrap.show .mob-glow{animation:mgPulse 2.5s ease-in-out infinite}

    @keyframes mhIn{
      0%{opacity:0;transform:scale(0) rotate(-20deg)}
      50%{opacity:1;transform:scale(1.2) rotate(5deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }
    @keyframes mhPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    @keyframes mgPulse{0%,100%{opacity:.3;transform:translate(-50%,-50%) scale(1)}50%{opacity:.7;transform:translate(-50%,-50%) scale(1.5)}}

    /* Mobile text */
    .mob-text{text-align:center;margin-bottom:.5rem}
    .mt{
      font-size:1.05rem;font-weight:500;line-height:1.55;
      margin-bottom:.85rem;color:#3a1520;
      opacity:0;transform:translateY(15px);
    }
    .mt.show{animation:mtIn .9s ease forwards}
    .mt1{font-style:italic;color:#4a2030;font-size:1.05rem}
    .mt4{font-family:'Dancing Script',cursive;font-size:1.8rem;font-weight:700;color:#c0354a;margin-top:.3rem}
    @keyframes mtIn{0%{opacity:0;transform:translateY(15px)}100%{opacity:1;transform:translateY(0)}}

    /* Mobile counter */
    .mob-counter{
      position:absolute;bottom:5%;left:0;right:0;
      text-align:center;opacity:0;
    }
    .mob-counter.show{animation:mcIn 1s ease forwards}
    .mob-cl{font-size:.9rem;color:#5a2a35;margin-bottom:.3rem}
    .mob-ct{font-family:'Dancing Script',cursive;font-size:1.15rem;font-weight:700;color:#c0354a}
    .mob-ct b{font-size:1.35rem;color:#e31b52;margin:0 1px}
    @keyframes mcIn{0%{opacity:0;transform:translateY(15px)}100%{opacity:1;transform:translateY(0)}}

    /* SVG heart drawing */
    .mob-svg-wrap{
      opacity:0;margin:1.2rem 0;display:flex;flex-direction:column;align-items:center;
      transition:opacity .6s ease;cursor:pointer;
    }
    .mob-svg-wrap.show{opacity:1}
    .mob-svg-heart{width:120px;height:110px}
    .svg-heart-path{
      stroke-dasharray:600;stroke-dashoffset:600;
      filter:drop-shadow(0 0 6px rgba(227,27,82,.35));
    }
    .mob-svg-wrap.show .svg-heart-path{
      animation:svgDraw 2.5s cubic-bezier(.4,0,.2,1) forwards;
    }
    @keyframes svgDraw{
      0%{stroke-dashoffset:600}
      100%{stroke-dashoffset:0}
    }
    .mob-svg-wrap.show .svg-heart-fill{
      animation:svgFill 1.2s ease .2s forwards;
    }
    @keyframes svgFill{
      0%{opacity:0}
      100%{opacity:.13}
    }
    .svg-label{
      font-family:'Dancing Script',cursive;font-size:1.4rem;font-weight:700;
      color:#c0354a;margin-top:.5rem;
      opacity:0;transform:translateY(8px);
    }
    .mob-svg-wrap.show .svg-label{
      animation:svgLabel .8s ease 2s forwards;
    }
    @keyframes svgLabel{
      0%{opacity:0;transform:translateY(8px)}
      100%{opacity:1;transform:translateY(0)}
    }

    /* SVG link clickable */
    .svg-link{cursor:pointer;text-align:center;line-height:1.6;font-size:1.15rem}
    .svg-link:active{transform:scale(.95)}
    .svg-hint{display:inline-block;font-size:.75rem;color:#e31b52;margin-top:.3rem;animation:hintPulse 2s ease-in-out infinite}
    @keyframes hintPulse{0%,100%{opacity:.4;transform:scale(1)}50%{opacity:1;transform:scale(1.05)}}

    /* ============ STATE 3: BABY REVEAL ============ */
    .baby-state{position:fixed;inset:0;z-index:20;opacity:0;transition:opacity 1.2s ease}
    .baby-state.hidden{display:none}
    .baby-state.show{opacity:1}
    .baby-scene{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      opacity:0;transition:opacity .5s ease;pointer-events:none;
    }
    .baby-scene.active{opacity:1;pointer-events:auto}

    /* Option buttons */
    .baby-opts{
      position:fixed;bottom:0;left:0;right:0;z-index:30;
      display:flex;align-items:center;justify-content:center;gap:.6rem;
      padding:1rem 0 max(1.4rem,env(safe-area-inset-bottom));
      background:linear-gradient(to top,rgba(0,0,0,.55) 0%,rgba(0,0,0,.15) 70%,transparent);
    }
    .bopt{
      background:rgba(255,255,255,.1);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,.18);color:rgba(255,255,255,.7);
      padding:.4rem 1rem;border-radius:20px;
      font-family:'Playfair Display',serif;font-size:.72rem;
      cursor:pointer;transition:all .3s ease;letter-spacing:.3px;
    }
    .bopt.active{background:rgba(255,255,255,.25);color:#fff;border-color:rgba(255,255,255,.4)}

    /* ----- Concept 1: El Latido ----- */
    #baby1{background:linear-gradient(170deg,#1a0a10 0%,#2a1520 50%,#1e0e15 100%)}
    .b1-sparks{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .b1-sp{
      position:absolute;border-radius:50%;
      background:radial-gradient(circle,#d4a574,#c9966e);
      animation:b1Up linear infinite;
    }
    @keyframes b1Up{
      0%{transform:translateY(0) scale(0);opacity:0}
      12%{opacity:.65;transform:translateY(-8vh) scale(1)}
      85%{opacity:.4}
      100%{transform:translateY(-105vh) scale(.15);opacity:0}
    }
    .b1-wrap{display:flex;flex-direction:column;align-items:center;padding:0 10%;width:100%}
    .b1-ecg{width:88%;max-width:310px;height:auto;margin-bottom:2rem;opacity:0}
    #baby1.active .b1-ecg{animation:bFadeIn .6s ease .3s forwards}
    .b1-line{
      stroke-dasharray:900;stroke-dashoffset:900;
      filter:drop-shadow(0 0 8px rgba(232,170,185,.5));
    }
    #baby1.active .b1-line{animation:b1Draw 6s linear .5s infinite}
    @keyframes b1Draw{
      0%{stroke-dashoffset:900;opacity:1}
      50%{stroke-dashoffset:0;opacity:1}
      65%{stroke-dashoffset:0;opacity:1}
      76%{stroke-dashoffset:0;opacity:0}
      77%{stroke-dashoffset:900;opacity:0}
      100%{stroke-dashoffset:900;opacity:0}
    }
    .b1-t1,.b1-t2{
      font-family:'Playfair Display',serif;text-align:center;
      color:rgba(232,185,195,.8);opacity:0;transform:translateY(10px);
    }
    .b1-t1{font-size:.95rem;font-style:italic;margin-bottom:.3rem}
    .b1-t2{font-size:1rem;margin-bottom:2rem}
    #baby1.active .b1-t1{animation:bSlideUp .8s ease 3.2s forwards}
    #baby1.active .b1-t2{animation:bSlideUp .8s ease 3.7s forwards}
    @keyframes bSlideUp{to{opacity:1;transform:translateY(0)}}
    .b1-name{
      font-family:'Dancing Script',cursive;font-size:2.8rem;font-weight:700;
      color:#d4a574;text-align:center;opacity:0;transform:scale(.8);
      text-shadow:0 0 30px rgba(212,165,116,.4),0 0 60px rgba(212,165,116,.15);
    }
    #baby1.active .b1-name{animation:bNameIn 1.5s cubic-bezier(.2,.8,.3,1) 4.5s forwards}
    @keyframes bNameIn{
      0%{opacity:0;transform:scale(.8)}
      60%{opacity:1;transform:scale(1.06)}
      100%{opacity:1;transform:scale(1)}
    }
    .b1-heart{
      font-size:1.4rem;color:#e31b52;margin-top:1rem;opacity:0;
      filter:drop-shadow(0 0 10px rgba(227,27,82,.5));
    }
    #baby1.active .b1-heart{animation:bFadeIn .5s ease 5.8s forwards,bBeat 1.5s ease-in-out 6.3s infinite}
    @keyframes bBeat{0%,100%{transform:scale(1)}50%{transform:scale(1.25)}}
    @keyframes bFadeIn{to{opacity:1}}

    /* ----- Concept 2: Estrellas ----- */
    #baby2{background:linear-gradient(170deg,#060a18 0%,#0c1230 50%,#080e20 100%)}
    #b2Canvas{position:absolute;inset:0;width:100%;height:100%}
    .b2-wrap{
      position:relative;z-index:2;
      display:flex;flex-direction:column;align-items:center;
      padding:0 10%;width:100%;
    }
    .b2-t1,.b2-t2{
      font-family:'Playfair Display',serif;text-align:center;
      color:rgba(200,210,235,.8);opacity:0;transform:translateY(10px);
    }
    .b2-t1{font-size:.95rem;font-style:italic;margin-bottom:.3rem}
    .b2-t2{font-size:1rem;margin-bottom:1.5rem}
    #baby2.active .b2-t1{animation:bSlideUp .8s ease .8s forwards}
    #baby2.active .b2-t2{animation:bSlideUp .8s ease 1.3s forwards}
    .b2-glow{
      width:130px;height:130px;border-radius:50%;margin-bottom:.8rem;
      background:radial-gradient(circle,rgba(212,165,116,.35) 0%,rgba(212,165,116,.08) 45%,transparent 70%);
      opacity:0;transform:scale(0);
    }
    #baby2.active .b2-glow{animation:b2Glow 2s cubic-bezier(.2,.8,.3,1) 2s forwards}
    @keyframes b2Glow{
      0%{opacity:0;transform:scale(0)}
      50%{opacity:1;transform:scale(1.4)}
      100%{opacity:.7;transform:scale(1)}
    }
    .b2-name{
      font-family:'Dancing Script',cursive;font-size:2.8rem;font-weight:700;
      color:#e8c98e;text-align:center;opacity:0;transform:scale(.8);
      text-shadow:0 0 25px rgba(232,201,142,.4),0 0 50px rgba(232,201,142,.15);
    }
    #baby2.active .b2-name{animation:b2Name 1.5s cubic-bezier(.2,.8,.3,1) 3.2s forwards}
    @keyframes b2Name{
      0%{opacity:0;transform:scale(.8);filter:blur(6px)}
      50%{opacity:1;filter:blur(0)}
      75%{transform:scale(1.06)}
      100%{opacity:1;transform:scale(1);filter:blur(0)}
    }
    .b2-heart{font-size:1.2rem;color:#ff6b8a;margin-top:.8rem;opacity:0}
    #baby2.active .b2-heart{animation:bFadeIn .5s ease 4.4s forwards,bBeat 1.5s ease-in-out 4.9s infinite}
    .b2-sub{
      font-family:'Dancing Script',cursive;font-size:1.15rem;
      color:rgba(200,210,235,.5);margin-top:.4rem;opacity:0;
    }
    #baby2.active .b2-sub{animation:bSlideUp .8s ease 5s forwards}

    /* ----- Concept 3: Floreciendo ----- */
    #baby3{background:linear-gradient(160deg,#fdf2f0,#f8e1dc 30%,#f2d0ca 60%,#ecc4bd)}
    .b3-dust{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .b3-dt{
      position:absolute;border-radius:50%;
      background:radial-gradient(circle,#d4a574,#c9966e);
      animation:b3Up linear infinite;
    }
    @keyframes b3Up{
      0%{transform:translateY(0) scale(0);opacity:0}
      15%{opacity:.55;transform:translateY(-6vh) scale(1)}
      80%{opacity:.35}
      100%{transform:translateY(-90vh) scale(.12);opacity:0}
    }
    .b3-wrap{
      position:relative;z-index:2;
      display:flex;flex-direction:column;align-items:center;
      padding:0 10%;width:100%;
    }
    .b3-t1,.b3-t2{
      font-family:'Playfair Display',serif;text-align:center;
      color:#3a1520;opacity:0;transform:translateY(10px);
    }
    .b3-t1{font-size:.95rem;font-style:italic;margin-bottom:.3rem}
    .b3-t2{font-size:1rem;margin-bottom:1.5rem}
    #baby3.active .b3-t1{animation:bSlideUp .8s ease .5s forwards}
    #baby3.active .b3-t2{animation:bSlideUp .8s ease 1s forwards}
    .b3-flower-area{width:150px;height:150px;margin-bottom:1rem;opacity:0}
    #baby3.active .b3-flower-area{animation:bFadeIn .5s ease 1.5s forwards}
    .b3-flower{width:100%;height:100%}
    .b3-p{
      opacity:0;
      transform-origin:50% 100%;transform-box:fill-box;
    }
    #baby3.active .b3-p{
      animation:b3Bloom .8s cubic-bezier(.2,.8,.3,1) forwards;
      animation-delay:calc(var(--pd) + 1.8s);
    }
    @keyframes b3Bloom{
      0%{opacity:0;transform:scaleY(0) scaleX(.5)}
      60%{opacity:.85;transform:scaleY(1.1) scaleX(1.05)}
      100%{opacity:.8;transform:scaleY(1) scaleX(1)}
    }
    .b3-ctr{opacity:0}
    #baby3.active .b3-ctr{animation:bFadeIn .4s ease 3.2s forwards}
    .b3-name{
      font-family:'Dancing Script',cursive;font-size:2.8rem;font-weight:700;
      color:#c0354a;text-align:center;opacity:0;transform:scale(.8);
      text-shadow:0 0 20px rgba(192,53,74,.15);
    }
    #baby3.active .b3-name{animation:bNameIn 1.2s cubic-bezier(.2,.8,.3,1) 3.5s forwards}
    .b3-sub{
      font-family:'Dancing Script',cursive;font-size:1.1rem;
      color:#8a4050;margin-top:.5rem;opacity:0;
    }
    #baby3.active .b3-sub{animation:bSlideUp .8s ease 4.5s forwards}

    /* Hide mobile state on desktop */
    @media(min-width:481px){
      .mob-state,.baby-state{display:none !important}
    }
  </style>

  <script>
    const isMobile=window.innerWidth<=480;

    const startDate=new Date('2020-06-14T00:00:00');
    const si=document.getElementById('stateInitial');

    // Desktop elements
    const st=document.getElementById('stateTree');
    const fh=document.getElementById('fallingHeart');
    const tw=document.getElementById('treeWrap');
    const lt=document.getElementById('loveText');
    const co=document.getElementById('counter');

    // Mobile elements
    const ms=document.getElementById('mobState');
    const mh=document.getElementById('mobHeart');
    const mg=document.querySelector('.mob-heart-glow');
    const mt=document.getElementById('mobText');
    const mc=document.getElementById('mobCounter');

    document.getElementById('heartClick')?.addEventListener('click',()=>{
      si?.classList.add('fade-out');
      setTimeout(()=>si?.classList.add('gone'),900);

      if(isMobile){
        startMobile();
      }else{
        startDesktop();
      }
    });

    // ===== DESKTOP FLOW =====
    function startDesktop(){
      setTimeout(()=>{st?.classList.remove('hidden');fh?.classList.add('go')},500);
      setTimeout(()=>tw?.classList.add('grow'),2000);
      lt?.querySelectorAll('.tl').forEach((l,i)=>setTimeout(()=>l.classList.add('show'),3800+i*900));
      setTimeout(()=>{co?.classList.add('show');startTick('ct')},7500);
      setTimeout(desktopSpawn,5000);
    }

    function desktopSpawn(){
      setInterval(()=>{
        if(!tw)return;
        const r=tw.getBoundingClientRect();
        if(r.width===0)return;
        const el=document.createElement('div');
        el.textContent='❤';el.style.position='fixed';
        el.style.pointerEvents='none';el.style.zIndex='50';el.style.lineHeight='1';
        el.style.left=(r.left+r.width*.15+Math.random()*r.width*.6)+'px';
        el.style.top=(r.top+20+Math.random()*r.height*.35)+'px';
        el.style.fontSize=(14+Math.random()*16)+'px';
        const c=['#e31b52','#c62828','#ff4081','#d32f2f','#e91e63','#ff1744'];
        el.style.color=c[Math.floor(Math.random()*c.length)];
        document.body.appendChild(el);
        const dx=-200-Math.random()*500,dy=150+Math.random()*350;
        const rot=-40-Math.random()*150,dur=6000+Math.random()*4000;
        el.animate([
          {transform:'translate(0,0) rotate(0deg)',opacity:1},
          {transform:`translate(${dx*.2}px,${dy*.2}px) rotate(${rot*.2}deg)`,opacity:.85},
          {transform:`translate(${dx*.45}px,${dy*.45}px) rotate(${rot*.45}deg)`,opacity:.6},
          {transform:`translate(${dx*.7}px,${dy*.7}px) rotate(${rot*.7}deg)`,opacity:.35},
          {transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}
        ],{duration:dur,easing:'ease-in',fill:'forwards'});
        setTimeout(()=>el.remove(),dur+100);
      },600);
    }

    // ===== MOBILE FLOW =====
    function startMobile(){
      setTimeout(()=>{
        ms?.classList.remove('hidden');
        initCanvasHearts();
        fireConfetti();
      },500);

      // Heart appears
      const hw=document.getElementById('mobHeartWrap');
      setTimeout(()=>hw?.classList.add('show'),900);

      // Text
      mt?.querySelectorAll('.mt').forEach((l,i)=>{
        setTimeout(()=>l.classList.add('show'),2400+i*1000);
      });

      // SVG heart draw
      const svgW=document.getElementById('mobSvg');
      setTimeout(()=>svgW?.classList.add('show'),5800);

      // SVG wrap + label → baby reveal
      document.getElementById('mobSvg')?.addEventListener('click',()=>showBabyReveal());

      // Counter
      setTimeout(()=>{
        mc?.classList.add('show');
        startTick('mobCt');
      },8200);

      // Periodic confetti bursts
      setTimeout(()=>setInterval(fireConfetti,5000),3000);
    }

    // Heart confetti explosions
    function fireConfetti(){
      if(typeof confetti==='undefined')return;
      const heart=confetti.shapeFromText({text:'❤️',scalar:2});
      const defaults={spread:360,ticks:120,gravity:.4,decay:.93,startVelocity:15,
        shapes:[heart],scalar:2,zIndex:100,disableForReducedMotion:true};

      confetti({...defaults,particleCount:25,origin:{x:.5,y:.35}});
      setTimeout(()=>confetti({...defaults,particleCount:15,origin:{x:.3,y:.5}}),300);
      setTimeout(()=>confetti({...defaults,particleCount:15,origin:{x:.7,y:.5}}),600);
    }

    // Canvas floating hearts (gentle bubbles rising)
    function initCanvasHearts(){
      const canvas=document.getElementById('mobCanvas') as HTMLCanvasElement;
      if(!canvas)return;
      const ctx=canvas.getContext('2d');
      if(!ctx)return;

      const W=canvas.width=window.innerWidth;
      const H=canvas.height=window.innerHeight;

      interface FloatingHeart{x:number;y:number;size:number;speed:number;opacity:number;
        swing:number;swingSpeed:number;phase:number;color:string;rot:number;rotSpeed:number}

      const hearts:FloatingHeart[]=[];
      const cols=['#e31b52','#c62828','#ff4081','#d32f2f','#e91e63','#ff1744','#ff5252','#d81b60'];

      function makeHeart():FloatingHeart{
        return{
          x:Math.random()*W,y:H+20+Math.random()*100,
          size:8+Math.random()*18,speed:.3+Math.random()*.8,
          opacity:.15+Math.random()*.4,
          swing:20+Math.random()*40,swingSpeed:.005+Math.random()*.015,
          phase:Math.random()*Math.PI*2,
          color:cols[Math.floor(Math.random()*cols.length)],
          rot:(Math.random()-.5)*.5,rotSpeed:(Math.random()-.5)*.01
        };
      }

      for(let i=0;i<35;i++){
        const h=makeHeart();
        h.y=Math.random()*H; // spread initial positions
        hearts.push(h);
      }

      function drawHeart(cx:number,cy:number,size:number,color:string,alpha:number,rot:number){
        ctx!.save();
        ctx!.translate(cx,cy);
        ctx!.rotate(rot);
        ctx!.globalAlpha=alpha;
        ctx!.fillStyle=color;
        ctx!.beginPath();
        const s=size/2;
        ctx!.moveTo(0,-s*.4);
        ctx!.bezierCurveTo(s*.8,-s*1.4,s*1.6,-.2*s,0,s);
        ctx!.bezierCurveTo(-s*1.6,-.2*s,-s*.8,-s*1.4,0,-s*.4);
        ctx!.fill();
        ctx!.restore();
      }

      let t=0;
      function animate(){
        ctx!.clearRect(0,0,W,H);
        t++;
        for(const h of hearts){
          h.y-=h.speed;
          h.x+=Math.sin(t*h.swingSpeed+h.phase)*h.swing*.02;
          h.rot+=h.rotSpeed;
          if(h.y<-30){
            h.y=H+20;h.x=Math.random()*W;
            h.size=8+Math.random()*18;
            h.opacity=.15+Math.random()*.4;
          }
          drawHeart(h.x,h.y,h.size,h.color,h.opacity,h.rot);
        }
        requestAnimationFrame(animate);
      }
      animate();
    }

    // ===== BABY REVEAL =====
    let b2Raf=0;
    let curBaby=0;

    function showBabyReveal(){
      const mobSt=document.getElementById('mobState');
      if(mobSt){
        mobSt.style.transition='opacity 1s ease';
        mobSt.style.opacity='0';
        setTimeout(()=>{mobSt.classList.add('hidden');mobSt.style.opacity=''},1000);
      }
      const bs=document.getElementById('babyState');
      setTimeout(()=>{
        if(!bs)return;
        bs.classList.remove('hidden');
        requestAnimationFrame(()=>bs.classList.add('show'));
        switchBaby(1);
      },800);
    }

    function switchBaby(n:number){
      if(n===curBaby)return;
      if(curBaby===2&&b2Raf){cancelAnimationFrame(b2Raf);b2Raf=0;}

      document.querySelectorAll('.baby-scene.active').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.bopt').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.bopt[data-v="${n}"]`)?.classList.add('active');

      curBaby=n;
      const scene=document.getElementById(`baby${n}`);
      if(!scene)return;
      void scene.offsetWidth;

      setTimeout(()=>{
        scene.classList.add('active');
        if(n===1)initB1();
        if(n===2)initB2();
        if(n===3)initB3();
      },60);
    }

    function initB1(){
      const c=document.getElementById('b1Sparks');
      if(!c||c.children.length>0)return;
      for(let i=0;i<25;i++){
        const s=document.createElement('div');
        s.className='b1-sp';
        s.style.left=Math.random()*100+'%';
        s.style.bottom=-Math.random()*15+'%';
        s.style.animationDuration=(10+Math.random()*14)+'s';
        s.style.animationDelay=Math.random()*12+'s';
        const sz=2+Math.random()*3;
        s.style.width=sz+'px';s.style.height=sz+'px';
        c.appendChild(s);
      }
    }

    function initB2(){
      if(b2Raf){cancelAnimationFrame(b2Raf);b2Raf=0;}
      const canvas=document.getElementById('b2Canvas') as HTMLCanvasElement;
      if(!canvas)return;
      const ctx=canvas.getContext('2d');
      if(!ctx)return;
      const W=canvas.width=window.innerWidth;
      const H=canvas.height=window.innerHeight;

      interface Star{x:number;y:number;r:number;a:number;ts:number;ph:number}
      interface Shoot{x:number;y:number;ang:number;spd:number;len:number;a:number;life:number;ml:number}

      const stars:Star[]=[];
      for(let i=0;i<80;i++){
        stars.push({x:Math.random()*W,y:Math.random()*H,r:.4+Math.random()*1.5,
          a:.3+Math.random()*.7,ts:.005+Math.random()*.02,ph:Math.random()*Math.PI*2});
      }
      const shoots:Shoot[]=[];
      let t=0;

      function frame(){
        ctx!.clearRect(0,0,W,H);t++;
        for(const s of stars){
          const al=s.a*(.5+.5*Math.sin(t*s.ts+s.ph));
          ctx!.beginPath();ctx!.arc(s.x,s.y,s.r,0,Math.PI*2);
          ctx!.fillStyle=`rgba(255,250,240,${al})`;ctx!.fill();
        }
        if(Math.random()<.006){
          const ang=Math.PI*.15+Math.random()*Math.PI*.25;
          shoots.push({x:Math.random()*W*.7,y:Math.random()*H*.3,ang,
            spd:3+Math.random()*4,len:30+Math.random()*50,a:1,life:0,ml:35+Math.random()*30});
        }
        for(let i=shoots.length-1;i>=0;i--){
          const sh=shoots[i];
          sh.x+=Math.cos(sh.ang)*sh.spd;sh.y+=Math.sin(sh.ang)*sh.spd;
          sh.life++;sh.a=1-sh.life/sh.ml;
          if(sh.a<=0){shoots.splice(i,1);continue;}
          const g=ctx!.createLinearGradient(sh.x,sh.y,
            sh.x-Math.cos(sh.ang)*sh.len,sh.y-Math.sin(sh.ang)*sh.len);
          g.addColorStop(0,`rgba(255,250,220,${sh.a})`);
          g.addColorStop(1,'rgba(255,250,220,0)');
          ctx!.beginPath();ctx!.moveTo(sh.x,sh.y);
          ctx!.lineTo(sh.x-Math.cos(sh.ang)*sh.len,sh.y-Math.sin(sh.ang)*sh.len);
          ctx!.strokeStyle=g;ctx!.lineWidth=1.5;ctx!.stroke();
        }
        b2Raf=requestAnimationFrame(frame);
      }
      frame();
    }

    function initB3(){
      const c=document.getElementById('b3Dust');
      if(!c||c.children.length>0)return;
      for(let i=0;i<20;i++){
        const d=document.createElement('div');
        d.className='b3-dt';
        d.style.left=Math.random()*100+'%';
        d.style.bottom=-Math.random()*10+'%';
        d.style.animationDuration=(12+Math.random()*16)+'s';
        d.style.animationDelay=Math.random()*14+'s';
        const sz=2+Math.random()*4;
        d.style.width=sz+'px';d.style.height=sz+'px';
        c.appendChild(d);
      }
    }

    // Option button handlers
    document.querySelectorAll('.bopt').forEach(b=>{
      b.addEventListener('click',()=>{
        const v=parseInt((b as HTMLElement).dataset.v||'1');
        switchBaby(v);
      });
    });

    // ===== SHARED COUNTER =====
    function startTick(elId: string){
      const el=document.getElementById(elId);
      function tick(){
        const d=Date.now()-startDate.getTime();
        const dd=Math.floor(d/864e5);
        const hh=Math.floor((d%864e5)/36e5);
        const mm=Math.floor((d%36e5)/6e4);
        const ss=Math.floor((d%6e4)/1e3);
        if(el) el.innerHTML=`<b>${dd}</b> días <b>${hh}</b> horas <b>${String(mm).padStart(2,'0')}</b> minutos <b>${String(ss).padStart(2,'0')}</b> segundos`;
      }
      tick();
      setInterval(tick,1000);
    }
  </script>
</body>
</html>
