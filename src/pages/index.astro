---
const colors = [
  '#e31b52','#c62828','#d32f2f','#e53935','#ef5350',
  '#f44336','#ff1744','#ff4081','#c0354a','#b71c1c',
  '#ad1457','#d81b60','#e91e63','#ff5252','#cc2244','#a8203a'
];

const canopyHearts: {x:number,y:number,size:number,color:string,delay:number}[] = [];
const cx = 220;
const cy = 185;

for (let layer = 0; layer < 4; layer++) {
  const count = 80;
  const scaleBase = 6 + layer * 3.5;
  for (let i = 0; i < count; i++) {
    const t = (i / count) * Math.PI * 2;
    const hxRaw = 16 * Math.pow(Math.sin(t), 3);
    const hyRaw = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
    const scale = scaleBase + Math.random() * 2.5;
    const x = cx + hxRaw * scale + (Math.random() - 0.5) * 22;
    const y = cy + hyRaw * scale + (Math.random() - 0.5) * 18;
    const size = 13 + Math.random() * 24;
    canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.0 + Math.random()*1.8 });
  }
}
for (let i = 0; i < 100; i++) {
  const angle = Math.random() * Math.PI * 2;
  const r = Math.random() * 120;
  const x = cx + Math.cos(angle) * r + (Math.random()-0.5)*15;
  const y = cy + Math.sin(angle) * r * 0.85 + 10;
  const size = 10 + Math.random() * 26;
  canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.2 + Math.random()*2.2 });
}
for (let i = 0; i < 30; i++) {
  const x = cx + (Math.random()-0.5) * 60;
  const y = cy + 100 + Math.random() * 80;
  const size = 12 + Math.random() * 20;
  canopyHearts.push({ x, y, size, color: colors[Math.floor(Math.random()*colors.length)], delay: 1.3 + Math.random()*1.5 });
}
---

<html lang="es">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>San Valentín</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet" />
</head>
<body>

  <!-- STATE 1: shared -->
  <div class="state-initial" id="stateInitial">
    <div class="bg-particles" id="bgParticles1"></div>
    <div class="heart-wrapper" id="heartClick">
      <div class="main-heart">❤</div>
      <div class="heart-label">San Valentín</div>
      <div class="click-hint">☝ Toca aquí</div>
    </div>
  </div>

  <!-- STATE 2 DESKTOP: tree -->
  <div class="state-tree hidden" id="stateTree">
    <div class="falling-heart" id="fallingHeart">❤</div>
    <div class="tree-wrap" id="treeWrap">
      <div class="trunk"></div>
      <div class="tbranch tb1"></div>
      <div class="tbranch tb2"></div>
      <div class="tbranch tb3"></div>
      <div class="tbranch tb4"></div>
      <div class="canopy">
        {canopyHearts.map((h) => (
          <span class="ch" style={`left:${h.x}px;top:${h.y}px;font-size:${h.size}px;color:${h.color};animation-delay:${h.delay}s`}>❤</span>
        ))}
      </div>
    </div>
    <div class="love-text" id="loveText">
      <p class="tl tl1">Para el amor de mi vida:</p>
      <p class="tl tl2">Si pudiera elegir un lugar<br/>seguro, sería a tu lado.</p>
      <p class="tl tl3">Cuanto más tiempo estoy<br/>contigo más te amo.</p>
      <p class="tl tl4">— I Love You!</p>
    </div>
    <div class="counter" id="counter">
      <p class="cl">Mi amor por ti comenzó hace...</p>
      <p class="ct" id="ct"></p>
    </div>
  </div>

  <!-- STATE 2 MOBILE: canvas hearts + confetti + text -->
  <div class="mob-state hidden" id="mobState">
    <canvas id="mobCanvas"></canvas>

    <div class="mob-content">
      <div class="mob-heart-wrap" id="mobHeartWrap">
        <div class="mob-glow"></div>
        <div class="mob-heart" id="mobHeart">❤</div>
      </div>

      <div class="mob-text" id="mobText">
        <p class="mt mt1">Para el amor de mi vida:</p>
        <p class="mt mt2">Si pudiera elegir un lugar<br/>seguro, sería a tu lado.</p>
        <p class="mt mt3">Cuanto más tiempo estoy<br/>contigo más te amo.</p>
        <p class="mt mt4">— I Love You!</p>
      </div>

      <div class="mob-counter" id="mobCounter">
        <p class="mob-cl">Mi amor por ti comenzó hace...</p>
        <p class="mob-ct" id="mobCt"></p>
      </div>
    </div>
  </div>

  <!-- canvas-confetti CDN -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      width:100vw;height:100vh;overflow:hidden;
      font-family:'Playfair Display',Georgia,serif;
      background:linear-gradient(160deg,#fdf2f0,#f8e1dc 30%,#f2d0ca 60%,#ecc4bd);
      color:#4a2028;
    }

    /* ============ STATE 1 (shared) ============ */
    .state-initial{
      position:fixed;inset:0;z-index:10;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(160deg,#fdf2f0,#f8e1dc 30%,#f2d0ca 60%,#ecc4bd);
      transition:opacity .8s ease;
    }
    .state-initial.fade-out{opacity:0;pointer-events:none}
    .state-initial.gone{display:none}
    .bg-particles{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .bp{position:absolute;color:rgba(220,80,100,.25);animation:pFloat linear infinite}
    @keyframes pFloat{
      0%{transform:translateY(100vh) rotate(0);opacity:0}
      10%{opacity:.6}90%{opacity:.6}
      100%{transform:translateY(-10vh) rotate(360deg);opacity:0}
    }
    .heart-wrapper{
      display:flex;flex-direction:column;align-items:center;
      cursor:pointer;user-select:none;z-index:2;
      animation:pulse 1.5s ease-in-out infinite;
    }
    .main-heart{font-size:7rem;color:#e31b52;line-height:1;filter:drop-shadow(0 4px 25px rgba(220,40,80,.5))}
    .heart-label{font-family:'Dancing Script',cursive;font-size:2.4rem;font-weight:700;margin-top:.5rem;color:#c0354a}
    .click-hint{margin-top:1.2rem;font-size:.9rem;color:#a05060;animation:blink 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
    @keyframes blink{0%,100%{opacity:.4}50%{opacity:1}}

    /* ============ STATE 2 DESKTOP ============ */
    .state-tree{position:fixed;inset:0;z-index:10}
    .state-tree.hidden{display:none}

    .falling-heart{
      position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);
      font-size:5rem;color:#e31b52;z-index:20;opacity:0;
      filter:drop-shadow(0 4px 15px rgba(220,40,80,.5));
    }
    .falling-heart.go{animation:hfall 1.5s cubic-bezier(.55,0,1,.45) forwards}
    @keyframes hfall{
      0%{top:45%;transform:translate(-50%,-50%) scale(1);opacity:1}
      65%{top:88%;transform:translate(-50%,-50%) scale(.7);opacity:1}
      75%{top:84%;transform:translate(-50%,-50%) scale(.8);opacity:1}
      85%{top:88%;transform:translate(-50%,-50%) scale(.5) rotate(10deg);opacity:1}
      95%{top:88%;transform:translate(-50%,-50%) scale(.2) rotate(15deg);opacity:.5}
      100%{top:88%;transform:translate(-50%,-50%) scale(0) rotate(20deg);opacity:0}
    }

    .tree-wrap{
      position:absolute;bottom:0;left:50%;transform:translateX(-25%);
      width:440px;height:580px;opacity:0;z-index:15;
    }
    .tree-wrap.grow{animation:tgrow 1.2s cubic-bezier(.2,.8,.3,1) forwards}
    @keyframes tgrow{
      0%{opacity:0;transform:translateX(-25%) scaleY(0);transform-origin:bottom center}
      40%{opacity:1}
      100%{opacity:1;transform:translateX(-25%) scaleY(1);transform-origin:bottom center}
    }
    .trunk{
      position:absolute;bottom:0;left:50%;transform:translateX(-50%);
      width:26px;height:280px;
      background:linear-gradient(to right,#5a3020,#8B5E3C,#6b3a2a);border-radius:6px;
    }
    .tbranch{position:absolute;background:linear-gradient(to top,#6b3a2a,#8B5E3C);border-radius:4px;transform-origin:bottom center}
    .tb1{bottom:175px;left:calc(50% - 9px);width:10px;height:85px;transform:rotate(30deg)}
    .tb2{bottom:195px;left:calc(50% + 1px);width:10px;height:90px;transform:rotate(-25deg)}
    .tb3{bottom:225px;left:calc(50% - 15px);width:8px;height:60px;transform:rotate(48deg)}
    .tb4{bottom:235px;left:calc(50% + 8px);width:8px;height:55px;transform:rotate(-42deg)}
    .canopy{position:absolute;top:0;left:0;width:440px;height:400px}
    .ch{position:absolute;line-height:1;opacity:0;filter:drop-shadow(0 1px 3px rgba(0,0,0,.12));margin-left:-.5em;margin-top:-.5em}
    .tree-wrap.grow .ch{animation:bloom .5s ease forwards}
    @keyframes bloom{
      0%{opacity:0;transform:scale(0) rotate(-20deg)}
      70%{transform:scale(1.2) rotate(5deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }
    .love-text{position:absolute;top:12%;left:5%;max-width:320px;z-index:16}
    .tl{font-size:1.15rem;font-weight:500;line-height:1.6;margin-bottom:1.1rem;color:#3a1520;opacity:0;transform:translateX(-15px)}
    .tl.show{animation:trev .9s ease forwards}
    .tl1{font-style:italic;color:#4a2030}
    .tl4{font-family:'Dancing Script',cursive;font-size:2rem;font-weight:700;color:#c0354a;margin-top:.5rem}
    @keyframes trev{0%{opacity:0;transform:translateX(-15px)}100%{opacity:1;transform:translateX(0)}}
    .counter{position:absolute;bottom:4%;left:5%;z-index:16;opacity:0}
    .counter.show{animation:fup 1s ease forwards}
    .cl{font-size:1rem;color:#5a2a35;margin-bottom:.3rem}
    .ct{font-family:'Dancing Script',cursive;font-size:1.4rem;font-weight:700;color:#c0354a}
    .ct b{font-size:1.7rem;color:#e31b52;margin:0 2px}
    @keyframes fup{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}

    /* Tablet */
    @media(max-width:768px) and (min-width:481px){
      .main-heart{font-size:5rem}
      .heart-label{font-size:1.8rem}
      .tree-wrap{width:350px;height:480px;left:50%;transform:translateX(-20%)}
      .canopy{width:350px;height:320px}
      .ch{font-size:.75em !important}
      .trunk{height:220px;width:22px}
      .love-text{top:5%;left:4%;max-width:42%}
      .tl{font-size:.92rem;margin-bottom:.8rem}
      .tl4{font-size:1.4rem}
      .ct{font-size:1.1rem}.ct b{font-size:1.3rem}
    }

    /* Hide desktop state2 on mobile, show mobile state2 */
    @media(max-width:480px){
      .state-tree{display:none !important}
      .main-heart{font-size:4.5rem}
      .heart-label{font-size:1.6rem}
      .click-hint{font-size:.8rem}
    }

    /* ============ STATE 2 MOBILE ============ */
    .mob-state{position:fixed;inset:0;z-index:10;overflow:hidden}
    .mob-state.hidden{display:none}

    #mobCanvas{position:absolute;inset:0;width:100%;height:100%;z-index:1}

    .mob-content{position:relative;z-index:2;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 8%}

    /* Hero heart */
    .mob-heart-wrap{position:relative;margin-bottom:1.5rem;opacity:0}
    .mob-heart-wrap.show{animation:mhIn 1.2s cubic-bezier(.2,.8,.3,1) forwards}
    .mob-heart{font-size:5.5rem;color:#e31b52;line-height:1;filter:drop-shadow(0 0 35px rgba(227,27,82,.6))}
    .mob-heart-wrap.show .mob-heart{animation:mhPulse 2s ease-in-out .8s infinite}
    .mob-glow{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      width:180px;height:180px;border-radius:50%;
      background:radial-gradient(circle,rgba(227,27,82,.2) 0%,transparent 70%);
    }
    .mob-heart-wrap.show .mob-glow{animation:mgPulse 2.5s ease-in-out infinite}

    @keyframes mhIn{
      0%{opacity:0;transform:scale(0) rotate(-20deg)}
      50%{opacity:1;transform:scale(1.2) rotate(5deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }
    @keyframes mhPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    @keyframes mgPulse{0%,100%{opacity:.3;transform:translate(-50%,-50%) scale(1)}50%{opacity:.7;transform:translate(-50%,-50%) scale(1.5)}}

    /* Mobile text */
    .mob-text{text-align:center;margin-bottom:auto}
    .mt{
      font-size:1.05rem;font-weight:500;line-height:1.55;
      margin-bottom:.85rem;color:#3a1520;
      opacity:0;transform:translateY(15px);
    }
    .mt.show{animation:mtIn .9s ease forwards}
    .mt1{font-style:italic;color:#4a2030;font-size:1.05rem}
    .mt4{font-family:'Dancing Script',cursive;font-size:1.8rem;font-weight:700;color:#c0354a;margin-top:.3rem}
    @keyframes mtIn{0%{opacity:0;transform:translateY(15px)}100%{opacity:1;transform:translateY(0)}}

    /* Mobile counter */
    .mob-counter{
      position:absolute;bottom:5%;left:0;right:0;
      text-align:center;opacity:0;
    }
    .mob-counter.show{animation:mcIn 1s ease forwards}
    .mob-cl{font-size:.9rem;color:#5a2a35;margin-bottom:.3rem}
    .mob-ct{font-family:'Dancing Script',cursive;font-size:1.15rem;font-weight:700;color:#c0354a}
    .mob-ct b{font-size:1.35rem;color:#e31b52;margin:0 1px}
    @keyframes mcIn{0%{opacity:0;transform:translateY(15px)}100%{opacity:1;transform:translateY(0)}}

    /* Hide mobile state on desktop */
    @media(min-width:481px){
      .mob-state{display:none !important}
    }
  </style>

  <script>
    const isMobile=window.innerWidth<=480;

    // BG particles state 1
    const pc=document.getElementById('bgParticles1');
    for(let i=0;i<15;i++){
      const p=document.createElement('div');
      p.className='bp';p.textContent='♥';
      p.style.left=Math.random()*100+'%';
      p.style.fontSize=(12+Math.random()*18)+'px';
      p.style.animationDuration=(10+Math.random()*15)+'s';
      p.style.animationDelay=-(Math.random()*20)+'s';
      pc?.appendChild(p);
    }

    const startDate=new Date('2020-06-14T00:00:00');
    const si=document.getElementById('stateInitial');

    // Desktop elements
    const st=document.getElementById('stateTree');
    const fh=document.getElementById('fallingHeart');
    const tw=document.getElementById('treeWrap');
    const lt=document.getElementById('loveText');
    const co=document.getElementById('counter');

    // Mobile elements
    const ms=document.getElementById('mobState');
    const mh=document.getElementById('mobHeart');
    const mg=document.querySelector('.mob-heart-glow');
    const mt=document.getElementById('mobText');
    const mc=document.getElementById('mobCounter');

    document.getElementById('heartClick')?.addEventListener('click',()=>{
      si?.classList.add('fade-out');
      setTimeout(()=>si?.classList.add('gone'),900);

      if(isMobile){
        startMobile();
      }else{
        startDesktop();
      }
    });

    // ===== DESKTOP FLOW =====
    function startDesktop(){
      setTimeout(()=>{st?.classList.remove('hidden');fh?.classList.add('go')},500);
      setTimeout(()=>tw?.classList.add('grow'),2000);
      lt?.querySelectorAll('.tl').forEach((l,i)=>setTimeout(()=>l.classList.add('show'),3800+i*900));
      setTimeout(()=>{co?.classList.add('show');startTick('ct')},7500);
      setTimeout(desktopSpawn,5000);
    }

    function desktopSpawn(){
      setInterval(()=>{
        if(!tw)return;
        const r=tw.getBoundingClientRect();
        if(r.width===0)return;
        const el=document.createElement('div');
        el.textContent='❤';el.style.position='fixed';
        el.style.pointerEvents='none';el.style.zIndex='50';el.style.lineHeight='1';
        el.style.left=(r.left+r.width*.15+Math.random()*r.width*.6)+'px';
        el.style.top=(r.top+20+Math.random()*r.height*.35)+'px';
        el.style.fontSize=(14+Math.random()*16)+'px';
        const c=['#e31b52','#c62828','#ff4081','#d32f2f','#e91e63','#ff1744'];
        el.style.color=c[Math.floor(Math.random()*c.length)];
        document.body.appendChild(el);
        const dx=-200-Math.random()*500,dy=150+Math.random()*350;
        const rot=-40-Math.random()*150,dur=6000+Math.random()*4000;
        el.animate([
          {transform:'translate(0,0) rotate(0deg)',opacity:1},
          {transform:`translate(${dx*.2}px,${dy*.2}px) rotate(${rot*.2}deg)`,opacity:.85},
          {transform:`translate(${dx*.45}px,${dy*.45}px) rotate(${rot*.45}deg)`,opacity:.6},
          {transform:`translate(${dx*.7}px,${dy*.7}px) rotate(${rot*.7}deg)`,opacity:.35},
          {transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}
        ],{duration:dur,easing:'ease-in',fill:'forwards'});
        setTimeout(()=>el.remove(),dur+100);
      },600);
    }

    // ===== MOBILE FLOW =====
    function startMobile(){
      setTimeout(()=>{
        ms?.classList.remove('hidden');
        initCanvasHearts();
        fireConfetti();
      },500);

      // Heart appears
      const hw=document.getElementById('mobHeartWrap');
      setTimeout(()=>hw?.classList.add('show'),900);

      // Text
      mt?.querySelectorAll('.mt').forEach((l,i)=>{
        setTimeout(()=>l.classList.add('show'),2400+i*1000);
      });

      // Counter
      setTimeout(()=>{
        mc?.classList.add('show');
        startTick('mobCt');
      },6800);

      // Periodic confetti bursts
      setTimeout(()=>setInterval(fireConfetti,5000),3000);
    }

    // Heart confetti explosions
    function fireConfetti(){
      if(typeof confetti==='undefined')return;
      const heart=confetti.shapeFromText({text:'❤️',scalar:2});
      const defaults={spread:360,ticks:120,gravity:.4,decay:.93,startVelocity:15,
        shapes:[heart],scalar:2,zIndex:100,disableForReducedMotion:true};

      confetti({...defaults,particleCount:25,origin:{x:.5,y:.35}});
      setTimeout(()=>confetti({...defaults,particleCount:15,origin:{x:.3,y:.5}}),300);
      setTimeout(()=>confetti({...defaults,particleCount:15,origin:{x:.7,y:.5}}),600);
    }

    // Canvas floating hearts (gentle bubbles rising)
    function initCanvasHearts(){
      const canvas=document.getElementById('mobCanvas') as HTMLCanvasElement;
      if(!canvas)return;
      const ctx=canvas.getContext('2d');
      if(!ctx)return;

      const W=canvas.width=window.innerWidth;
      const H=canvas.height=window.innerHeight;

      interface FloatingHeart{x:number;y:number;size:number;speed:number;opacity:number;
        swing:number;swingSpeed:number;phase:number;color:string;rot:number;rotSpeed:number}

      const hearts:FloatingHeart[]=[];
      const cols=['#e31b52','#c62828','#ff4081','#d32f2f','#e91e63','#ff1744','#ff5252','#d81b60'];

      function makeHeart():FloatingHeart{
        return{
          x:Math.random()*W,y:H+20+Math.random()*100,
          size:8+Math.random()*18,speed:.3+Math.random()*.8,
          opacity:.15+Math.random()*.4,
          swing:20+Math.random()*40,swingSpeed:.005+Math.random()*.015,
          phase:Math.random()*Math.PI*2,
          color:cols[Math.floor(Math.random()*cols.length)],
          rot:(Math.random()-.5)*.5,rotSpeed:(Math.random()-.5)*.01
        };
      }

      for(let i=0;i<35;i++){
        const h=makeHeart();
        h.y=Math.random()*H; // spread initial positions
        hearts.push(h);
      }

      function drawHeart(cx:number,cy:number,size:number,color:string,alpha:number,rot:number){
        ctx!.save();
        ctx!.translate(cx,cy);
        ctx!.rotate(rot);
        ctx!.globalAlpha=alpha;
        ctx!.fillStyle=color;
        ctx!.beginPath();
        const s=size/2;
        ctx!.moveTo(0,-s*.4);
        ctx!.bezierCurveTo(s*.8,-s*1.4,s*1.6,-.2*s,0,s);
        ctx!.bezierCurveTo(-s*1.6,-.2*s,-s*.8,-s*1.4,0,-s*.4);
        ctx!.fill();
        ctx!.restore();
      }

      let t=0;
      function animate(){
        ctx!.clearRect(0,0,W,H);
        t++;
        for(const h of hearts){
          h.y-=h.speed;
          h.x+=Math.sin(t*h.swingSpeed+h.phase)*h.swing*.02;
          h.rot+=h.rotSpeed;
          if(h.y<-30){
            h.y=H+20;h.x=Math.random()*W;
            h.size=8+Math.random()*18;
            h.opacity=.15+Math.random()*.4;
          }
          drawHeart(h.x,h.y,h.size,h.color,h.opacity,h.rot);
        }
        requestAnimationFrame(animate);
      }
      animate();
    }

    // ===== SHARED COUNTER =====
    function startTick(elId: string){
      const el=document.getElementById(elId);
      function tick(){
        const d=Date.now()-startDate.getTime();
        const dd=Math.floor(d/864e5);
        const hh=Math.floor((d%864e5)/36e5);
        const mm=Math.floor((d%36e5)/6e4);
        const ss=Math.floor((d%6e4)/1e3);
        if(el) el.innerHTML=`<b>${dd}</b> días <b>${hh}</b> horas <b>${String(mm).padStart(2,'0')}</b> minutos <b>${String(ss).padStart(2,'0')}</b> segundos`;
      }
      tick();
      setInterval(tick,1000);
    }
  </script>
</body>
</html>
